(this["webpackJsonpbus-eta"]=this["webpackJsonpbus-eta"]||[]).push([[0],{84:function(e){e.exports=JSON.parse("{}")},96:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),s=n(11),r=n.n(s),i=n(66),o=n(15),l=n(141),j=n(146),u=n(148),b=n(145),f=n(56),O=n.n(f),d=n(149),h=n(99),p=n(98),x=n(154),m=n(150),g=n(151),S=n(156),v=n(57),y=n(147),k=n(28),w=n.n(k),C=n(38),E=n(152),_=n(153),A=(n(84),n(7)),B=Object(l.a)({option:{fontSize:15,"& > span":{marginRight:10,fontSize:18}}});function I(e){var t=B(),n=Object(c.useState)(!0),s=Object(o.a)(n,2),r=s[0],i=s[1],l=Object(c.useState)([]),j=Object(o.a)(l,2),u=j[0],b=j[1];return Object(c.useEffect)((function(){fetch("https://data.etabus.gov.hk/v1/transport/kmb/stop").then((function(e){return e.json()})).then((function(e){console.log(e),b(e.data),i(!1)}))}),[]),Object(c.useEffect)((function(){console.log("useeffect get station",void fetch("https://data.etabus.gov.hk/v1/transport/kmb/stop").then((function(e){return e.json()})).then((function(e){return e.data})))}),[]),r?"Loading":Object(A.jsx)(_.a,{id:"country-busstop",onChange:function(t,n){null!==n&&e.changeSelectStop(n.stop)},defaultValue:u.find((function(t){return t.stop===e.defaultStop})),style:{minWidth:600},options:u,classes:{option:t.option},autoHighlight:!0,getOptionLabel:function(e){return e.name_tc+" "+e.name_en},renderOption:function(e){return Object(A.jsxs)(a.a.Fragment,{children:[e.name_tc," ",e.name_en]})},renderInput:function(e){return Object(A.jsx)(E.a,Object(C.a)(Object(C.a)({},e),{},{label:"Choose a bus stop",variant:"outlined",inputProps:Object(C.a)(Object(C.a)({},e.inputProps),{},{autoComplete:"new-password"})}))}})}var N=Object(l.a)((function(e){return{title:{flexGrow:2,align:"center"},menuButton:{marginRight:e.spacing(2)},typography:{align:"center"},min:{align:"center"}}})),R=function(e,t){var n=N(),a=Object(c.useState)([]),s=Object(o.a)(a,2),r=s[0],i=s[1],l=Object(c.useState)(),u=Object(o.a)(l,2),b=u[0],f=u[1],O=Object(c.useState)(),d=Object(o.a)(O,2),x=d[0],m=d[1],g=Object(c.useState)(e.defaultStop?e.defaultStop:"9583BCF159B682BA"),S=Object(o.a)(g,2),v=S[0],k=S[1],C=Object(c.useState)(e.defaultnumETA?e.defaultnumETA:1),E=Object(o.a)(C,2),_=E[0],B=E[1],R=_>0,T=function(){console.log("fetchKMB"),fetch("https://data.etabus.gov.hk/v1/transport/kmb/stop-eta/"+v).then((function(e){return e.json()})).then((function(t){console.log(t),i(t.data.filter((function(t){return t.eta_seq<=_&&1===t.service_type&&(!!e.isSpecialRoute||!t.rmk_en.includes("route only"))}))),f(t.generated_timestamp),m(w()())}))},M=function(e){var t=w()(e),n=-1*w()().diff(t,"seconds"),c=-1*w()().diff(t,"minutes");return n>60?c+" min":"- min"};return Object(c.useEffect)((function(){T();var e=setInterval((function(){T()}),5e3);return function(){return clearInterval(e)}}),[v,_,e.isSpecialRoute]),Object(c.useImperativeHandle)(t,(function(){return{selectStop:v,numETA:_}}),[v,_]),Object(A.jsxs)(j.a,{children:[Object(A.jsxs)(j.a,{container:!0,style:{padding:"5px"},children:[Object(A.jsx)(j.a,{container:!0,direction:"row",justify:"space-between",alignItems:"center",children:Object(A.jsx)(j.a,{align:"center",style:{flex:2},children:Object(A.jsx)(I,{changeSelectStop:function(e){k(e)},defaultStop:e.defaultStop})})}),Object(A.jsx)(j.a,{style:{flex:1},alignItems:"center",justifyContent:"center",children:Object(A.jsxs)(y.a,{children:[Object(A.jsx)(p.a,{onClick:function(){B(_+1)},children:"+"}),R&&Object(A.jsx)(p.a,{disabled:!0,children:_}),R&&Object(A.jsx)(p.a,{onClick:function(){B(_-1)},children:"-"})]})}),Object(A.jsxs)(j.a,{style:{flex:1,align:"center"},children:[Object(A.jsxs)(h.a,{align:"right",children:["Last Update Time: ",w()(b).format("YYYY/MM/DD HH:mm:ss")]}),Object(A.jsxs)(h.a,{align:"right",children:["Last Refresh Time:"," ",w()(x).format("YYYY/MM/DD HH:mm:ss")]})]})]}),Object(A.jsx)(j.a,{direction:"row",justify:"space-between",alignItems:"center",children:r.map((function(e,t){return Object(A.jsxs)(j.a,{container:!0,direction:"row",justify:"space-between",alignItems:"center",children:[Object(A.jsx)(j.a,{style:{flex:1},children:1===e.eta_seq&&Object(A.jsx)(h.a,{align:"center",variant:"h3",children:e.route})}),Object(A.jsx)(j.a,{style:{flex:4},children:1===e.eta_seq&&Object(A.jsxs)(h.a,{align:"center",variant:"h5",className:n.typography,children:[Object(A.jsx)(h.a,{variant:"h5",className:n.typography,children:e.dest_tc}),Object(A.jsx)(h.a,{variant:"h6",className:n.typography,children:e.dest_en})]})}),Object(A.jsx)(j.a,{style:{flex:1},children:Object(A.jsxs)(h.a,{align:"center",className:n.min,children:[Object(A.jsx)(h.a,{variant:"h4",children:M(e.eta)}),Object(A.jsx)(h.a,{variant:"h6",children:e.rmk_tc})]})}),Object(A.jsx)("img",{src:"https://na.cx/i/cMDkd52.jpg",className:"photo",alt:"KMB",width:"100px",height:"100px"})]})}))})]})},T=Object(c.forwardRef)(R),M=Object(l.a)((function(e){return{BusStop:{flexGrow:2,align:"center"}}}));function Y(){var e=M(),t=Object(c.useState)(1),n=Object(o.a)(t,2),a=(n[0],n[1],Object(c.useState)(!1)),s=Object(o.a)(a,2),r=s[0],l=s[1],f=Object(c.useState)(!1),y=Object(o.a)(f,2),k=y[0],w=y[1],C=Object(c.useState)([]),E=Object(o.a)(C,2),_=E[0],B=E[1],I=Object(c.useState)([]),N=Object(o.a)(I,2),R=N[0],Y=N[1],H=new v.a;return Object(c.useEffect)((function(){B((function(e){return Array(R.length).fill().map((function(t,n){return e[n]||Object(c.createRef)()}))}))}),[R]),Object(c.useEffect)((function(){console.log("elRefs",_)}),[_]),Object(c.useEffect)((function(){var e=H.get("station");e&&Y(e)}),[]),Object(A.jsxs)(j.a,{children:[Object(A.jsx)(u.a,{color:"secondary",children:Object(A.jsxs)(d.a,{children:[Object(A.jsx)(b.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu",onClick:function(){l(!0)},children:Object(A.jsx)(O.a,{})}),Object(A.jsx)(h.a,{variant:"h6",className:e.title,children:"Bus Arrival Time"})]})}),Object(A.jsx)(d.a,{}),Object(A.jsx)(j.a,{container:!0,direction:"row",justify:"flex-start",alignItems:"baseline",children:R.map((function(e,t){return Object(A.jsx)(j.a,{style:{flex:1},children:Object(A.jsx)(T,{ref:_[t],isSpecialRoute:k,defaultStop:e.current.selectStop,defaultnumETA:e.current.numETA})})}))}),Object(A.jsxs)(x.a,{open:r,onOpen:r,children:[Object(A.jsx)(p.a,{onClick:function(){l(!1)},children:"Close"}),Object(A.jsx)(p.a,{onClick:function(){var e=JSON.stringify(_);console.log(_),console.log(e),(new v.a).set("station",e,{path:"/",maxAge:2147483647})},children:"Save"}),Object(A.jsx)(p.a,{onClick:function(){Y((function(e){return[].concat(Object(i.a)(e),[{current:{stop:"",numETA:1}}])}))},children:"add"}),Object(A.jsx)(p.a,{onClick:function(){Y([])},children:"remove all"}),Object(A.jsx)(m.a,{column:!0,children:Object(A.jsx)(g.a,{control:Object(A.jsx)(S.a,{checked:k,onChange:function(e){w(e.target.checked)}}),label:"\u7279\u5225\u8def\u7dda"})})]})]})}var H=document.getElementById("root");r.a.render(Object(A.jsx)(c.StrictMode,{children:Object(A.jsx)(Y,{})}),H)}},[[96,1,2]]]);
//# sourceMappingURL=main.5efc9b75.chunk.js.map